---
title: "WIP - Aquifex ASV variation"
author: "Cassandra Wattenburger"
date: "9/8/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = "show")
knitr::opts_chunk$set(message = FALSE)
```

```{r}
library("tidyverse")
sessionInfo()
```

Import data and calculate:

```{r}
# Isolate Aquifex ASVs from raw data
count <- read_tsv(file="/home/cassi/growthrate2018/output/growthrate.counts.finalv2.tsv")
tax <- read_tsv(file="/home/cassi/growthrate2018/output/growthrate.taxonomy.final.tsv")

aquifex_asvs <- tax %>%
  filter(Genus=="Aquifex") %>%
  select(OTU)

aquifex_count <- count %>%
  filter(OTU.ID %in% aquifex_asvs$OTU) %>%
  column_to_rownames(var = "OTU.ID")

# Calculate relative abundance of each ASV per sample
aquifex_count <- t(aquifex_count) %>% as.tibble()
aquifex_relabund <- aquifex_count %>%
  add_column(total = rowSums(aquifex_count)) %>%
  mutate(across(everything(), ~ (.x/total), .names = "{.col}")) %>%
  select(-total) %>%
  na.omit()

# Average relative abundance for each ASV across all samples
avg <- aquifex_relabund %>%
  colMeans() %>%
   as.data.frame()

# Maximum and minimum relative abundance for each ASV across all samples
min <- as.data.frame(apply(aquifex_relabund, 2, min))
max <-  as.data.frame(apply(aquifex_relabund,2,max))
```

Results:

```{r}
# Create summary table
aquifex_summary <- bind_cols(avg, max, min) %>%
  rownames_to_column(var="ASV")
colnames(aquifex_summary) <- c("ASV", "relabund_avg", "relabund_max", "relabund_min")
aquifex_summary 

# Visual
aquifex_relabund %>%
  pivot_longer(everything(), names_to = "ASV", values_to="relabund") %>%
  ggplot() +
    geom_boxplot(aes(x=ASV, y=relabund, group=ASV)) +
  labs(title = "Aquifex ASV variants", x="ASV variants", y="relative abundance of variant") +
  theme_test() +
  theme(axis.text.x = element_text(angle=45))
```

```{r, eval=FALSE, include=FALSE}
write_tsv(aquifex_summary, file="growthrate_aquifex_asv_var_summary.tsv")
```

