---
title: "Dunlop growth rates - biomass and growth rates"
author: "Cassandra Wattenburger"
date: "12/19/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = "show")
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

**Goal of this script:** Explore relationship between biomass and growth rates

Main hypothesis: From Sam's full cyc work. High biomass microbial communities are less responsive to C inputs/avialability (up to a point)
because the C is accessed by more cells and distiributed more evenly among community. In low biomass microbial communities, less cells will have more access to the available C. This will result in moderate growth by many taxa in the high biomass soil but rapid growth by few taxa in the low biomass soil.

Here, we are considering the successional and cropped soils as proxies for high and low biomass communities respectively to see if we can find evidence for this hypothesis.

# Import libraries

```{r}
library(tidyverse)

rm(list=ls())

sessionInfo()
```

# Assess biomass between soils

Using DNA extraction yield as a proxy for microbial biomass. First check if there is evidence for a difference in DNA yield between the cropped and successional soils.

### Import data

```{r}
# Field and ucosm community data
ucosm = readRDS("../rdata.files/gr_ucosm.norm.clean.rds") 
field = readRDS("../rdata.files/gr_field.norm.clean.rds") %>% 
  mutate(norm_abund = as.numeric(norm_abund))

# DNA data
dna = read_csv("../metadata/growthrate_dnaext.csv") %>%
  mutate(Sample = as.numeric(SampleID))

# Combine
ucosm.field.dna = bind_rows(field, ucosm) %>% # combine ucosm and field samples
  inner_join(dna) %>% # add dna data
  rename(dna_conc = Conc., dna_kit = Box) %>% # rename columns
  mutate(Type = if_else(Sample %in% 1:80, "Field", "Microcosm")) # Name based on experiment type

# Estimated growth rates
growth <- readRDS("../rdata.files/gr_gr.paprica.clean.rds")
```

### Visualize

```{r}
# Field
ucosm.field.dna %>%
  distinct(Sample, Soil, Amendment, Block, Type, dna_conc) %>%
  filter(Type=="Field") %>%
  ggplot(aes(x=Soil, y=dna_conc)) +
  geom_point() +
  labs(title="Field") +
  facet_wrap(~Block) +
  theme_test()

# Microcosm
ucosm.field.dna %>%
  distinct(Sample, Soil, Amendment, Day, Type, dna_conc) %>%
  filter(Type=="Microcosm", Day==0) %>% # day 0 samples only
  ggplot(aes(x=Soil, y=dna_conc)) +
  geom_point() +
  labs(title="Ucosms") +
  theme_test()
```

Microcosm soil DNA yeild decreased compared to field samples, particularly in successional soil. Disturbance of sieving and storing must have been very destructive. Unfortunately, this will mask any correlations between growth rates and DNA conc.

### Statistics

**Field soil**

* Only testing block 1 because that's where the soil for the microcosms originated
* Simple linear model

```{r}
# Isolate data
field.block1 = ucosm.field.dna %>%
  filter(Type=="Field", Block==1) %>%
  distinct(Sample, Soil, dna_conc)

# Fit linear model
field.block1.lm = lm(log(dna_conc) ~ Soil, field.block1)
hist(resid(field.block1.lm)) # normal w/log transform
plot(predict(field.block1.lm), resid(field.block1.lm)) # unequal variance w/ or w/0 log

# Switch to Kruskal Wallis (non-parametric)
kruskal.test(log(dna_conc) ~ Soil, field.block1)
```

**Microcosm soil**

* Testing only day 0
* simple linear model

```{r}
# Isolate data
ucosm0 = ucosm.field.dna %>%
  filter(Type=="Microcosm", Day==0) %>%
  distinct(Sample, Soil, dna_conc)

# Fit linear model
ucosm0_lm = lm(log(dna_conc) ~ Soil, ucosm0)
hist(resid(ucosm0_lm)) # normal enough?
plot(predict(ucosm0_lm), resid(ucosm0_lm)) # variance OK
anova(ucosm0_lm)
```

