---
title: "Dunlop gr - estimated and non-estimated communities comparison"
author: "Cassandra Wattenburger"
date: "12/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = "show")
knitr::opts_chunk$set(message = FALSE)
```

```{r}
rm(list=ls())

library("phyloseq")
library("tidyverse")

sessionInfo()
```

# Import data

```{r}
# Normalized abundance data
norm <- readRDS("../rdata.files/gr_ucosm.norm.clean.rds")

# Growth estimates
growth <- readRDS("../rdata.files/gr_gr.paprica.clean.rds")
```

Isolate estimated and non-estimated ASVs

```{r}
est_yes <- norm %>% 
  semi_join(growth, by=c("ASV", "Soil", "Amendment", "Replicate")) %>% 
  filter(Day==0,
         norm_abund > 0) %>% 
  add_column(Estimated = "yes")
  
est_no <- norm %>% 
  anti_join(growth, by=c("ASV", "Soil", "Amendment", "Replicate")) %>% 
  filter(Day==0,
         norm_abund > 0) %>% 
  add_column(Estimated = "no")

norm_est <- bind_rows(est_yes, est_no)
```

# Abundances at tp0

See if there was a starting abundance bias in the taxa that were estimated.

```{r}
norm_est %>%
  ggplot(aes(x=Estimated, y=log(norm_abund))) +
  geom_jitter(alpha=0.5) +
  facet_wrap(Soil~Amendment) +
  theme_test()
```

There are many more non-estimated taxa than estimated, so I'm going to "rarefy" by randomly selecting ASVs from the non-estimated group until the same number of taxa are represented in each treatment.

```{r}
# Randomly sample non-estimated taxa
set.seed(2)

rand_est_no <- est_no %>% 
  slice_sample(n=nrow(est_yes))

rand_norm_est <- rand_est_no %>% 
  bind_rows(est_yes)

rand_norm_est %>% 
  ggplot(aes(x=Estimated, y=log(norm_abund))) +
  geom_boxplot() +
  geom_jitter(alpha=0.5) +
  theme_test()
```

**Statistics**

Linear model

```{r}
rand_est_lm <- lm(log(norm_abund) ~ Estimated, data=rand_norm_est)
hist(resid(rand_est_lm))
plot(predict(rand_est_lm), resid(rand_est_lm))
anova(rand_est_lm)
```

# Community composition

Compare community compositions of estimated and non-estimated taxa.

On hold.

